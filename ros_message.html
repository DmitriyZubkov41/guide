<html><head></head><body>
<title>Сообщения</title>
<h2 align=center>Сообщения</h2>
Ссылки: <a href="http://docs.voltbro.ru/starting-ros/messaging/message.html">Из книги братьев Вольт</a>
<p>
Ноды отправляют и принимают данные между собой, согласно заданного формата. Эти данные называют Сообщения, а описание Типом Сообщения.<br>
Сообщения описываются в файлах .msg как пары значений: тип поля и имя поля:<br>
fieldtype fieldname<br>
fieldtype1 fieldname1
<p>
Сообщения могут быть как простых типов (integer, float, boolean), так и могут состоять из сложных структур, содержащих вложенные сообщения и массивы сообщений.
<p>
Например для сообщения с координатами обьекта (XYZ) есть существующий тип сообщения geometry_msgs/Point.msg который описывается:
<pre>
float64 x
float64 y
float64 z
</pre>
<p>
<b>Некоторые команды:</b><br>
Просмотр определения типа сообщения: <font color=green>rosmsg show type</font>

<h3 align="center">Знакомство с файлами msg</h3>
msg-файлы - это простые текстовые файлы, которые описывают поля сообщений ROS. Они используются для создания исходного кода сообщений на разных языках. Они хранятся в папке msg каталога пакета. Представляют собой просто текстовые файлы с типом поля и названием поля в каждой строке.<br>
Тип поля:
<ul>
    <li> int8, int16, int32, int64 (plus uint*)
    <li> float32, float64
    <li> string
    <li> time, duration
    <li> other msg files
    <li> variable-length array[] and fixed-length array[C]
</ul>
Существует также тип Header. Header содержит временную метку и информацию о координатной системе, которые обычно используются в ROS. Вы часто увидите, что в первой строке msg-файла есть заголовок Header.

<h3>Пример создания файла.msg (Num.msg):</h3>
<ol>
<li> Переходим в каталог пакета (roscd или просто cd)<br>
Создаём внутри пакета каталог msg: mkdir msg<br>
Что-то записываем в создаваемый файл, например: echo "int64 num" > msg/Num.msg
<li>
Далее нужно убедиться, что msg-файлы преобразованы в исходный код для C++, Python и других языков. Для этого открыть package.xml и убедитесь, что эти две строки есть в нем и не закомментированы:<br>
<img src="./images/package.xml.png"><br>
<font color=red>Были закомментированы, исправил.</font>
<li>
<h4>Редактирование CMakeLists.txt</h4>
<ol>
<li> Во время сборки нужен "message_generation", в время выполнения "message_runtime"<br>
<li> Далее открыть CMakeLists.txt В нем в функцию find_package добавить <b>message_generation</b>, тем самым можем генерировать сообщения.<br>
    <font color="red">Добавил.</font><br>
    <img src="./images/find_package.png">
<p>
    Вы можете заметить, что иногда ваш проект собирается нормально, даже если вы не вызывали find_package со всеми зависимостями. Это связано с тем, что catkin объединяет все ваши проекты в один, поэтому, если более ранний проект вызывает find_package, ваш более поздний настроен с теми же значениями. Но если вы забудете о вызове, это означает, что ваш проект может легко прерваться при изолированной сборке.
<li> Также убедитесь, что вы экспортировали зависимость от среды выполнения сообщений:<br>
<img src="./images/message_runtime.png"><br>
Добавил.
<p>
<li> Исправил блок:<br>
    <img src="./images/message_file.png">
<li> Теперь мы должны убедиться, что функция generate_messages() вызвана (раскомментировал блок):<br>
    <img src="./images/generate_message.png">
   </ol>
</ol>
Теперь вы готовы сгенерировать исходные файлы из вашего определения msg.

<h3>Создание новых сообщений (из книги братьев Вольт)</h3>
В процессе разработки часто возникает необходимость создавать собственные типы сообщений с уникальной структурой данных. Файлы с описанием сообщений необходимо хранить в директории ./msg При этом имя файла определяет название типа созданного сообщения.<br>
Например, мы хотим использовать данные с датчика давления и температуры BMP180. Мы предполагаем, что нам понадобится передавать два значения: давление и температура (стандартные параметры для барометрических датчиков).
<p>
Создадим файл ./msg/Barometer.msg
<p>
<pre>
uint16  pressure
float32 temperature
</pre>
<p>
Для правильного подключения созданных .msg файлов необходимо удостовериться, что установлены все зависимости и внесены изменения в конфигурацию пакета:
<ol>
<li>. Файл package.xml должен содержать следующие строчки:
<p>
<pre>
<build_depend>message_generation</build_depend>
<exec_depend>message_generation</exec_depend>
</pre>
<li>. Файл CMakeLists.txt должен содержать следующие изменения для подключения процесса обработки сообщений:
<p>
<pre>
find_package(catkin REQUIRED COMPONENTS
    roscpp
    rospy
    std_msgs
    message_generation)

catkin_package(
   CATKIN_DEPENDS
   message_generation
   roscpp
   rospy
   std_msgs
)

## Generate messages in the 'msg' folder
add_message_files(

   FILES

   Barometer.msg
)

 generate_messages(
   DEPENDENCIES
   std_msgs
)
</pre>
</ol>
После этого необходимо запустить процесс сборки пакета командой catkin_make:
<p>
cd ~/catkin_ws && catkin_make
<p>
Проверить правильность создания нового типа сообщений Barometer.msg в пакет можно выполнить поиском по названию сообщения:
<p>
rosmsg list | grep Baro
<p>
Подключить .msg файл в python:
<p>
<pre>
import rospy
from ros_book_samples.msg import Barometer
</pre>
<p>
После изменения файла .msg всегда необходимо "пересобирать" проект через вызов catkin_make. Файлы .msg не используются напрямую, а служат инструкцией для генерации вспомогательных файлов, которые подключаются после их вызова. Например из файла Barometer.msg создается файл для python devel/lib/python2.7/dist-packages/ros\_book\_samples/msg/\_Barometer.py.


<h3>Консольная утилита rosmsg</h3>
rosmsg это удобный инструмент командной строки, который предоставляют справочную информацию для разработчиков, а также служит мощным средством анализа для получения дополнительной информации о данных, передаваемых в ROS.
<p>
Например, если вы используете сообщение в своем коде, вы можете выполнить rosmsg show в командной строке для получения списка полей используемых в сообщении:
<p>
<font color="green">rosmsg show [message type]</font>
<p>
message type состоит из имени пакета, где определён файл сообщения и файла.msg
<p>
<img src="./images/rosmsg_show1.png">
<p>
Если не помним название пакета, то можно без него показать тип сообщения:
<br>
<img src="./images/rosmsg_show2.png">
<p>
<b>Команды консольной утилиты rosmsg:</b>
<ul>
<li>    rosmsg show    Показать информацию о сообщении
<li>    rosmsg info    Алиас для команды rosmsg show
<li>    rosmsg list    Вывести все существующие типы сообщений
<li>    rosmsg md5    Отобразить md5sum сообщения
<li>    rosmsg package    Список всех сообщений в пакете
<li>    rosmsg packages    Список пакетов, использующих сообщение
</ul>













<br><br><br><br><br><br><br></body></html>
