<html><head></head><body>
<title>Сервер параметров</title>
<h2 align=center>Сервер параметров (Parameter Server)</h2>
Ссылки: <a href="https://wiki.ros.org/Parameter%20Server">Parameter Server</a>
<p>
<b>Параметрами</b> в ROS называют конфигурационную информацию хранящуюся на сервере параметров и необходимую для работы нодов. В рамках одной инстанции ROS все ноды могут получать прозрачный, централизованный доступ к параметрам (создание, изменение, удаление).
<p>
1. <b>Parameters</b><br>
Сервер параметров - это общий многовариантный словарь, доступный через сетевые API. Узлы используют этот сервер для хранения и извлечения параметров во время выполнения. Поскольку он не рассчитан на высокую производительность, его лучше всего использовать для статических, недвоичных данных, таких как параметры конфигурации. Он предназначен для глобального просмотра, чтобы инструменты могли легко проверять состояние конфигурации системы и при необходимости вносить изменения.
<p>
Сервер параметров реализован с использованием XMLRPC и работает внутри ROS Master, что означает, что его API доступен через обычные библиотеки XMLRPC.
<p>
Параметры именуются в соответствии с обычным соглашением об именовании ROS. Это означает, что параметры ROS имеют иерархию, соответствующую пространствам имен, используемым для разделов и узлов. Эта иерархия предназначена для защиты имен параметров от конфликтов. Иерархическая схема также позволяет обращаться к параметрам по отдельности или в виде дерева. Например, для следующих параметров:
<pre>
/camera/left/name: leftcamera
/camera/left/exposure: 1
/camera/right/name: rightcamera
/camera/right/exposure: 1.1
</pre>
Параметр /camera/left/name имеет значение leftcamera. Вы также можете получить значение для параметра /camera/left, который является словарем:
<pre>
name: leftcamera
exposure: 1</pre>
И вы также можете получить значение для /camera, которое содержит словарь словарей, представляющих дерево параметров:
<pre>
left: { name: leftcamera, exposure: 1 }
right: { name: rightcamera, exposure: 1.1 }
</pre>
ПРИМЕЧАНИЕ: В текущей реализации не соблюдаются соглашения об именовании параметров. Однако в будущем они могут быть изменены, поэтому вам следует им следовать.
<p>
2. <b>Parameter Types</b><br>
Сервер параметров использует типы данных XMLRPC для значений параметров, которые включают:
<ul>
<li> 32-bit integers
<li> booleans
<li> strings
<li> doubles
<li> iso8601 dates
<li> lists
<li> base64-encoded binary data
</ul>
Вы также можете хранить словари (т.е. структуры) на сервере параметров, хотя они имеют особое значение. Сервер параметров представляет пространства имен ROS в виде словарей. Например, представьте, что вы задали следующие три параметра:
<pre>
/gains/P = 10.0
/gains/I = 1.0
/gains/D = 0.1</pre>
Вы можете либо прочитать их обратно по отдельности, т.е. при извлечении /gains/P будет возвращено значение 10.0, либо вы можете получить /gains, которое вернет словарь:
<pre>{ 'P': 10.0, 'I': 1.0, 'D' : 0.1 }</pre>
Точно так же, как в иерархии именования ROS, вы можете вставлять словари в словари для представления дочерних пространств имен.
<p>
<b>3. Private Parameters</b><br>
В соглашении об именовании ROS ~name используется как частное имя. Эти частные имена в основном предназначены для параметров, специфичных для одного узла. Префикс ~ добавляется перед именем узла, чтобы использовать его как полузакрытое пространство имен - они по-прежнему доступны из других частей системы, но, как правило, защищены от случайных коллизий имен.
<p>
Вы можете использовать аргументы переназначения для указания параметров узла в командной строке, изменив тильду ~ на символ подчеркивания _, например:
<pre>rosrun rospy_tutorials talker _param:=1.0</pre>
<p>
<b><a href="https://wiki.ros.org/rosparam">4. Parameter Tools</a></b><br>
Средство командной строки rosparam позволяет запрашивать и устанавливать параметры на сервере параметров, используя синтаксис YAML.
<p>
rosparam содержит инструмент командной строки rosparam для получения и настройки параметров ROS на сервере параметров с использованием файлов, закодированных в YAML. Он также содержит экспериментальную библиотеку для использования YAML с сервером параметров. Эта библиотека предназначена только для внутреннего использования. rosparam может быть вызван из файла roslaunch.
<p>
<b>YAML Format</b><br>
rosparam использует соответствие 1 к 1 между типами серверов параметров и типами YAML. Например:
<pre>
string: 'foo'
integer: 1234
float: 1234.5
boolean: true
list: [1.0, mixed list]
dictionary: {a: b, c: d}</pre>
Словари YAML могут использоваться в качестве аргумента для команд load и set в rosparam. Словари в этом контексте интерпретируются иначе, чем словари пространства имен, которые задаются в качестве значения параметра (например, из узла C++ или Python). Вместо замены пространства имен параметров словари в rosparam распаковываются в отдельные параметры, которые устанавливаются на сервере параметров. Таким образом, словари rosparam можно рассматривать как добавление новых значений в пространство имен параметров.
<p>
Существуют также специальные преобразователи для представления углов в радианах и градусах. Любое математическое выражение, доступное для языка Python, может быть использовано со значением в радианах, при этом pi используется для представления числа pi.
<pre>
angle1: rad(2*pi)
angle2: deg(180)</pre>
или:
<pre>angle1: !degrees 181.0
angle2: !radians 3.14169</pre>
В любом случае значение угла преобразуется в радианы (с плавающей точкой).
<h4>roslaunch API</h4>
Тег &lt;rosparam&gt; позволяет использовать инструмент rosparam для загрузки и выгрузки параметров, закодированных в файлах YAML. Тег &lt;rosparam&gt; может быть помещен внутри тега &lt;node&gt;, и в этом случае параметр рассматривается как личное имя.
<p>
Задать значение параметра можно несколькими способами:<ul>
<li> В launch файлах через теги «param» и «rosparam»;
<li> Через параметры командной строки при запуске ноды;
<li> В процессе выполнения самих нод (в коде);
<li> Используя утилиту командной строки «rosparam».
</ul>
<p>
Параметр сервер не рассчитан на большую нагрузку, слишком частое считывание/изменение параметров может привести к перегрузке сервера и ядра ROS. Для часто меняющихся параметров лучше использовать обычную публикацию/подписку или специальный пакет dynamic_reconfigure.
<h4>Задание значений параметров через launch файлы</h4>
Launch файлы это что-то вроде центрального конфигурационного файла всей системы. Во первых в них перечисляются все запускаемые ноды, а во вторых они является самым типичным местом для задания значений параметров, для этого в них предусмотрено два тега «param» и «rosparam». Первый используется для задания одного единственного параметра, а с помощью «rosparam» можно задавать несколько параметров одновременно, также, только с помощью этого тэга можно задавать параметры с комплексными типами list и dictionary.
<h4 align=center>Команда rosparam</h4>
Инструмент rosparam позволяет устанавливать и получать параметры из командной строки, а также загружать и сохранять состояние сервера параметров в файл. В настоящее время поддерживаются следующие команды:
<ul>
<li> <b>rosparam set &lt;parameter-name&gt; [parameter-value]</b><br>
Установит для параметра значение [parameter-value]. [parameter-value] является обязательным, если не указаны --textfile или --binfile.<br>
ПРИМЕЧАНИЕ: если значение параметра является словарем, это добавит его к текущим заданным значениям.<br>
Пример: Настройка списка с единицей в виде строки, целого числа и числа с плавающей точкой:
<pre>rosparam set /foo "['1', 1, 1.0]"</pre>
Настройка всего пространства имен параметров с помощью словаря YAML:
<pre>
rosparam set /gains "p: 1.0
 i: 1.0
 d: 1.0"</pre>
Аргументы:<br>
-v Показывать подробные выходные данные.<br>
-t &lt;text_file&gt;, --textfile &lt;text_file&gt; New in Diamondback<br>
Установит значение параметра равным содержимому текстового файла &lt;text_file&gt;.<br>
-b &lt;binary_file&gt;, --binfile &lt;binary_file&gt; New in Diamondback<br>
Задаёт параметру значение, соответствующее содержимому двоичного файла &lt;binary_file&gt;. Сервер параметров сохранит значение в виде двоичного типа XML-RPC (в кодировке Base 64).
<li> <b>rosparam get &lt;parameter-name&gt;</b><br>
Получить значение параметра &lt;parameter-name&gt;<br>
-p - Выводится красивым шрифтом. ВНИМАНИЕ: это небезопасно для YAML.<br>
-v - Показывать подробные выходные данные.
<li> <b>rosparam load &lt;yaml-file&gt; [namespace]</b><br>
Загрузит параметры из файла YAML в указанное [пространство имен] (по умолчанию /). ПРИМЕЧАНИЕ: это добавит дополнительные значения к текущим.<br>
<b>-v</b> Показывать подробные выходные данные.
<li> <b>rosparam dump &lt;file&gt;</b><br>
Перенесёт содержимое сервера параметров в формате YAML в файл file.yaml.<br>
rosparam dump &lt;file&gt; &lt;namespace&gt;<br>
Выводит только параметры в указанном пространстве имен.<br>
-v Подробный вывод. например:
<pre>
rosparam dump -v gains.yaml /gains
dumping namespace [/gains] to file [gains.yaml]
/gains/i=1.0
/gains/p=1.0
/gains/d=1.0</pre>
<li> <b>rosparam delete &lt;parameter-name&gt;</b><br>
Удалит значение параметра.
<li> <b>rosparam list</b><br>
Список имен всех параметров.<br>
<i>rosparam list &lt;namespace&gt;</i> список всех параметров в отдельном namespace
</ul>
Аргументы командной строки для параметра rosparam соответствуют переменной окружения ROS_NAMESPACE (см. раздел Переменные окружения). Имена параметров, которые не заданы глобально, разрешаются в соответствии с параметром ROS_NAMESPACE.
<br>ПРИМЕЧАНИЕ: get и dump - это, по сути, одна и та же команда, как и set и load, с единственной разницей в том, используется файл или нет.












<br><br><br><br></body></html>
